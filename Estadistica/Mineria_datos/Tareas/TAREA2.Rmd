---
title: "TAREA 2"
author: "María Pallares Diez"
date: "2025-01-08"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 8, fig.height = 6, fig.align = "center")
```

## Introducción

En esta tarea, realizaremos un Análisis de Componentes Principales (ACP) sobre dos bancos de datos: `datos` y `datos_b`. Los datos están contenidos en los archivos `datosp1.RData` y `datosp1_b.RData` respectivamente. Se calcularán las desviaciones típicas de las variables cuantitativas, se determinará el método adecuado para el ACP y se analizarán los resultados.

## Carga de datos

```{r carga_datos}
# Cargar los datos
load("datosp1.RData")
load("datosp1_b.RData")
```

## a. Desviaciones típicas y elección del método

### Desviaciones típicas

```{r desviaciones}
# Filtrar solo columnas numéricas para evitar errores con factores
datos_numericos <- datos[sapply(datos, is.numeric)]
datos_b_numericos <- datos_b[sapply(datos_b, is.numeric)]

# Calcular desviaciones típicas para las variables cuantitativas de ambos bancos
sapply(datos_numericos, sd, na.rm = TRUE)
sapply(datos_b_numericos, sd, na.rm = TRUE)
```

### Justificación del método

A partir de las desviaciones típicas, si las variables tienen escalas muy diferentes, se usará la matriz de correlaciones para estandarizar las variables antes del análisis. De lo contrario, se usará la matriz de varianzas-covarianzas.

## b. Análisis de Componentes Principales

### ACP para `datos`

```{r acp_datos}
# Realizar ACP
acp_datos <- prcomp(datos, scale. = TRUE)
summary(acp_datos)
```

#### Pregunta 1: Porcentaje de varianza explicado

La varianza explicada por la primera componente es:

```{r varianza_datos}
sum(acp_datos$sdev^2 / sum(acp_datos$sdev^2))
```

### ACP para `datos_b`

```{r acp_datos_b}
# Realizar ACP
acp_datos_b <- prcomp(datos_b_numericos, scale. = TRUE)
summary(acp_datos_b)
```

#### Pregunta 2: Número de componentes para el 90% de varianza

```{r componentes_necesarias}
cumsum(acp_datos_b$sdev^2) / sum(acp_datos_b$sdev^2)
```

#### Pregunta 3: Diferencias entre resultados

Comparemos los porcentajes de varianza explicados por las primeras componentes entre ambos conjuntos de datos.

### Interpretación de las componentes principales para `datos_b`

```{r interpretacion}
# Cargar coeficientes de las primeras componentes
acp_datos_b$rotation[, 1:2]
```

#### Pregunta 5: Gráfico de individuos

```{r grafico_individuos}
library(ggplot2)

# Crear un data frame con las primeras dos componentes
individuos <- data.frame(acp_datos_b$x[, 1:2])
colnames(individuos) <- c("Componente1", "Componente2")
individuos$Centro <- as.factor(datos_b$Centro)  # Suponiendo que existe esta columna

# Gráfico
ggplot(individuos, aes(x = Componente1, y = Componente2, color = Centro)) +
  geom_point(size = 3) +
  theme_minimal() +
  labs(title = "Proyección de individuos en las dos primeras componentes principales",
       x = "Componente Principal 1",
       y = "Componente Principal 2") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.title = element_text(size = 14),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 10))
```

## Conclusiones

En esta sección se discutirán las diferencias observadas entre los conjuntos de datos, la importancia de las componentes principales y la interpretación de los resultados obtenidos.
